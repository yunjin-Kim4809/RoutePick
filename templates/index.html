<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>RoutePick</title>
    <style>
        body {
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f8f9fa;
            font-family: sans-serif;
        }

        .card {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
            width: 420px;
        }

        .btn-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }

        button {
            padding: 10px;
            cursor: pointer;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: white;
            font-size: 16px;
        }

        button:hover {
            background: #f0f0f0;
        }

        input[type="text"] {
            padding: 10px;
            border: 2px solid #007bff;
            border-radius: 6px;
            width: 300px;
            text-align: center;
            margin-bottom: 10px;
            font-size: 16px;
        }

        input[type="date"] {
            padding: 10px;
            border: 2px solid #007bff;
            border-radius: 6px;
            width: 300px;
            text-align: center;
            margin-bottom: 10px;
            font-size: 16px;
            cursor: pointer;
        }

        input[type="date"]::-webkit-calendar-picker-indicator {
            cursor: pointer;
            font-size: 18px;
            opacity: 0.7;
        }

        input[type="date"]::-webkit-calendar-picker-indicator:hover {
            opacity: 1;
        }

        .date-input-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .date-range-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .date-range-item {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
        }

        .date-range-item label {
            font-size: 14px;
            color: #666;
            min-width: 60px;
            text-align: left;
        }

        .date-range-item input[type="date"] {
            width: 250px;
            margin-bottom: 0;
        }

        .date-separator {
            font-size: 18px;
            color: #007bff;
            font-weight: bold;
            margin: 5px 0;
        }

        .calendar-icon {
            font-size: 24px;
            color: #007bff;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .transportation-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 100%;
            margin-bottom: 10px;
        }

        .transportation-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            background: white;
        }

        .transportation-option:hover {
            background: #f0f0f0;
        }

        .transportation-option input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .transportation-option label {
            flex: 1;
            cursor: pointer;
            font-size: 16px;
            margin: 0;
        }

        .transportation-option-other {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            background: white;
        }

        .transportation-option-other:hover {
            background: #f0f0f0;
        }

        .transportation-option-other input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .transportation-option-other label {
            cursor: pointer;
            font-size: 16px;
            margin: 0;
            min-width: 40px;
        }

        .transportation-option-other input[type="text"] {
            flex: 1;
            padding: 8px;
            border: 2px solid #007bff;
            border-radius: 6px;
            font-size: 16px;
        }

        .result-item {
            text-align: left;
            background: #eee;
            margin: 5px 0;
            padding: 10px;
            border-radius: 4px;
        }
    </style>
</head>

<body>

    <div class="card">
        {% if not finished %}
        <h2>{{ messages[step - 1] }}</h2>

        <form id="mainForm" method="POST">
            <input type="hidden" name="choice" id="choice">
            <input type="hidden" name="source" id="source">

            {% if step == 1 %}
            íŒ: ì§€ì—­, ë‚ ì”¨, ì—¬í–‰ ëª©ì ë“±ì„ ìì„¸í•˜ê²Œ ì…ë ¥í•˜ë©´ ì¢‹ì•„ìš”!<br><br>
            <div class="input-group">
                <input type="text" id="textInput" placeholder="ì˜ˆì‹œ: ë¹„ ì˜¤ëŠ” ë‚  ì„œìš¸ ì‹¤ë‚´ ë°ì´íŠ¸">
                <button type="button" onclick="sendText()">í™•ì¸</button>
            </div>

            {% elif step == 2 %}
            <div class="input-group">
                <input type="text" id="textInput" placeholder="ì˜ˆì‹œ: ì„œìš¸, ë¶€ì‚°">
                <button type="button" onclick="sendText()">í™•ì¸</button>
            </div>

            {% elif step == 3 %}
            <div class="btn-group">
                <button type="button" onclick="send('1', 'button')">1ëª…</button>
                <button type="button" onclick="send('2', 'button')">2ëª…</button>
                <button type="button" onclick="send('3', 'button')">3ëª…</button>
                <div class="input-set">
                    <input type="text" id="textInput" placeholder="ìˆ«ìë¡œë§Œ ì…ë ¥í•´ ì£¼ì„¸ìš”.">
                    <button type="button" onclick="sendText()">í™•ì¸</button>
                </div>
                <button type="button" onclick="send('2', 'button')">ê±´ë„ˆë›°ê¸°</button>
            </div>

            {% elif step == 4 %}
            <div class="input-group">
                <div class="date-range-wrapper">
                    <div class="date-range-item">
                        <span class="calendar-icon">ğŸ“…</span>
                        <label for="startDate">ì‹œì‘ì¼:</label>
                        <input type="date" id="startDate">
                    </div>
                    <div class="date-separator">~</div>
                    <div class="date-range-item">
                        <span class="calendar-icon">ğŸ“…</span>
                        <label for="endDate">ì¢…ë£Œì¼:</label>
                        <input type="date" id="endDate">
                    </div>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button type="button" onclick="sendDateRange()">í™•ì¸</button>
                    <button type="button" onclick="send('', 'input')">ê±´ë„ˆë›°ê¸°</button>
                </div>
            </div>
            
            {% elif step == 5 %}
            <div class="input-group">
                <input type="text" id="textInput" placeholder="ì˜ˆì‹œ: ì˜¤í›„, ì €ë…">
                <button type="button" onclick="sendText()">í™•ì¸</button>
                <button type="button" onclick="send('ì˜¤í›„', 'input')">ê±´ë„ˆë›°ê¸°</button>
            </div>

            {% elif step == 6 %}
            <div class="input-group">
                <div class="transportation-options">
                    <div class="transportation-option" onclick="toggleCheckbox('walk')">
                        <input type="checkbox" id="walk" value="ë„ë³´" onchange="updateTransportation()">
                        <label for="walk">ë„ë³´</label>
                    </div>
                    <div class="transportation-option" onclick="toggleCheckbox('subway')">
                        <input type="checkbox" id="subway" value="ì§€í•˜ì² " onchange="updateTransportation()">
                        <label for="subway">ì§€í•˜ì² </label>
                    </div>
                    <div class="transportation-option" onclick="toggleCheckbox('bus')">
                        <input type="checkbox" id="bus" value="ë²„ìŠ¤" onchange="updateTransportation()">
                        <label for="bus">ë²„ìŠ¤</label>
                    </div>
                    <div class="transportation-option" onclick="toggleCheckbox('car')">
                        <input type="checkbox" id="car" value="ìë™ì°¨" onchange="updateTransportation()">
                        <label for="car">ìë™ì°¨</label>
                    </div>
                    <div class="transportation-option-other">
                        <input type="checkbox" id="other" onchange="updateTransportation()">
                        <label for="other" onclick="toggleCheckbox('other')">ê¸°íƒ€</label>
                        <input type="text" id="customTransportInput" placeholder="ì´ë™ìˆ˜ë‹¨ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" oninput="updateTransportation()" onclick="event.stopPropagation()">
                    </div>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button type="button" onclick="sendTransportation()">í™•ì¸</button>
                    <button type="button" onclick="send('ë„ë³´', 'input')">ê±´ë„ˆë›°ê¸°</button>
                </div>
            </div>
            {% endif %}
        </form>

        <script>
            // ëª¨ë“  ì „ì†¡ ë¡œì§ì„ í•˜ë‚˜ë¡œ í†µí•©í•˜ì—¬ íš¨ìœ¨í™”
            function send(value, src) {
                document.getElementById("choice").value = value;
                document.getElementById("source").value = src;
                document.getElementById("mainForm").submit();
            }

            function sendText() {
                const val = document.getElementById("textInput").value.trim();
                if (!val) {
                    alert("ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
                    return;
                }
                send(val, "input");
            }

            function sendDateRange() {
                const startDate = document.getElementById("startDate");
                const endDate = document.getElementById("endDate");
                
                if (startDate && endDate) {
                    const startValue = startDate.value;
                    const endValue = endDate.value;
                    
                    if (!startValue || !endValue) {
                        alert("ì‹œì‘ì¼ê³¼ ì¢…ë£Œì¼ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”!");
                        return;
                    }
                    
                    // ì‹œì‘ì¼ì´ ì¢…ë£Œì¼ë³´ë‹¤ ëŠ¦ìœ¼ë©´ ê²½ê³ 
                    if (startValue > endValue) {
                        alert("ì‹œì‘ì¼ì€ ì¢…ë£Œì¼ë³´ë‹¤ ì´ì „ì´ê±°ë‚˜ ê°™ì•„ì•¼ í•©ë‹ˆë‹¤!");
                        return;
                    }
                    
                    // ë‚ ì§œ ë²”ìœ„ë¥¼ "ì‹œì‘ì¼~ì¢…ë£Œì¼" í˜•ì‹ìœ¼ë¡œ ì „ì†¡
                    // ì‹œì‘ì¼ê³¼ ì¢…ë£Œì¼ì´ ê°™ìœ¼ë©´ ë‹¨ì¼ ë‚ ì§œë¡œ ì „ì†¡
                    const dateRange = startValue === endValue ? startValue : `${startValue}~${endValue}`;
                    send(dateRange, "input");
                } else {
                    // dateInputì´ ì—†ëŠ” ê²½ìš° (ë‹¤ë¥¸ step) ê¸°ì¡´ ë¡œì§ ì‚¬ìš©
                    sendText();
                }
            }

            function toggleCheckbox(id) {
                const checkbox = document.getElementById(id);
                if (checkbox) {
                    checkbox.checked = !checkbox.checked;
                    updateTransportation();
                }
            }

            function updateTransportation() {
                // ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸ (UI ë°˜ì‘ìš©)
                const otherCheckbox = document.getElementById("other");
                const customInput = document.getElementById("customTransportInput");
                
                if (otherCheckbox && customInput) {
                    // ê¸°íƒ€ ì²´í¬ë°•ìŠ¤ê°€ ì²´í¬ë˜ì§€ ì•Šì•˜ìœ¼ë©´ ì…ë ¥ í•„ë“œ ë¹„í™œì„±í™”
                    customInput.disabled = !otherCheckbox.checked;
                    if (!otherCheckbox.checked) {
                        customInput.value = "";
                    }
                }
            }

            function sendTransportation() {
                const selected = [];
                
                // ì²´í¬ëœ ì˜µì…˜ ìˆ˜ì§‘
                const walk = document.getElementById("walk");
                const subway = document.getElementById("subway");
                const bus = document.getElementById("bus");
                const car = document.getElementById("car");
                const other = document.getElementById("other");
                const customInput = document.getElementById("customTransportInput");
                
                if (walk && walk.checked) selected.push("ë„ë³´");
                if (subway && subway.checked) selected.push("ì§€í•˜ì² ");
                if (bus && bus.checked) selected.push("ë²„ìŠ¤");
                if (car && car.checked) selected.push("ìë™ì°¨");
                
                // ê¸°íƒ€ ì˜µì…˜ ì²˜ë¦¬
                if (other && other.checked && customInput) {
                    const customValue = customInput.value.trim();
                    if (customValue) {
                        selected.push(customValue);
                    } else {
                        alert("ê¸°íƒ€ë¥¼ ì„ íƒí•˜ì…¨ìŠµë‹ˆë‹¤. ì´ë™ìˆ˜ë‹¨ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
                        return;
                    }
                }
                
                if (selected.length === 0) {
                    alert("ì´ë™ìˆ˜ë‹¨ì„ í•˜ë‚˜ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”!");
                    return;
                }
                
                // ì„ íƒëœ ì´ë™ìˆ˜ë‹¨ì„ ì‰¼í‘œë¡œ êµ¬ë¶„í•˜ì—¬ ì „ì†¡
                const transportationValue = selected.join(", ");
                send(transportationValue, "input");
            }

            // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
            window.addEventListener('DOMContentLoaded', function() {
                // ë‚ ì§œ ì„ íƒ ì´ˆê¸°í™” (step 4ì¸ ê²½ìš°)
                const startDate = document.getElementById("startDate");
                const endDate = document.getElementById("endDate");
                
                if (startDate && endDate) {
                    // ì˜¤ëŠ˜ ë‚ ì§œë¥¼ ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •
                    const today = new Date();
                    const year = today.getFullYear();
                    const month = String(today.getMonth() + 1).padStart(2, '0');
                    const day = String(today.getDate()).padStart(2, '0');
                    const todayStr = `${year}-${month}-${day}`;
                    
                    startDate.value = todayStr;
                    endDate.value = todayStr;
                    
                    // ìµœì†Œ ë‚ ì§œë¥¼ ì˜¤ëŠ˜ë¡œ ì„¤ì •
                    startDate.min = todayStr;
                    endDate.min = todayStr;
                    
                    // ì‹œì‘ì¼ì´ ë³€ê²½ë˜ë©´ ì¢…ë£Œì¼ì˜ ìµœì†Œê°’ ì—…ë°ì´íŠ¸
                    startDate.addEventListener('change', function() {
                        if (this.value) {
                            endDate.min = this.value;
                            // ì¢…ë£Œì¼ì´ ì‹œì‘ì¼ë³´ë‹¤ ì´ì „ì´ë©´ ì¢…ë£Œì¼ë„ ì‹œì‘ì¼ë¡œ ì„¤ì •
                            if (endDate.value && endDate.value < this.value) {
                                endDate.value = this.value;
                            }
                        }
                    });
                }
                
                // ì´ë™ìˆ˜ë‹¨ ì„ íƒ ì´ˆê¸°í™” (step 6ì¸ ê²½ìš°)
                const customInput = document.getElementById("customTransportInput");
                if (customInput) {
                    customInput.disabled = true;
                }
            });

            document.getElementById("mainForm").addEventListener("keydown", function (e) {
                if (e.key === "Enter") {
                    e.preventDefault();
                }
            });
        </script>

        {% else %}
        <h2>ì…ë ¥ ì •ë³´ í™•ì¸</h2>
        {% for item in results %}
        <div class="result-item">{{ messages[loop.index - 1] }}: {{ item }}</div>
        {% endfor %}
        <a href="/call-agent"><button class="btn-call-agent">í™•ì¸</button></a>
        <a href="/reset"><button class="btn-reset">ë‹¤ì‹œ ì…ë ¥</button></a>
        {% endif %}
    </div>

</body>

</html>